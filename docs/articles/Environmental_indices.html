<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Environmental variables • ClimMobTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Environmental variables">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ClimMobTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Environmental_indices.html">Environmental variables</a>
    </li>
    <li>
      <a href="../articles/Overview.html">Introduction to ClimMobTools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Environmental variables</h1>
                        <h4 class="author">Kauê de Sousa</h4>
            <address class="author_afil">
      Department of Agricultural Sciences, Høgskolen i Innlandet, Norway<br><div class="hidden name"><code>Environmental_indices.Rmd</code></div>

    </address>
</div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Understanding how different crop varieties respond to environmental variation is a valuable approach to provide recommendations based on genotype x environment (GxE) interactions for climate adaptation. <strong>ClimMobTools</strong> provides the toolkit to compute environmental variables that serves as input for the ranking analysis with explanatory variables using <a href="https://CRAN.R-project.org/package=PlackettLuce">Plackett-Luce</a><span class="citation"><sup>1</sup></span> or <a href="https://CRAN.R-project.org/package=psychotree">Bradley-Terry</a><span class="citation"><sup>2</sup></span> model.</p>
<p>The climatic variables available in <strong>ClimMobTools</strong> were previously used for the environmental analysis of wheat trial data<span class="citation"><sup>3</sup></span> and explain the changes in climatic patterns due to climate change<span class="citation"><sup>4</sup></span>. In a more advanced analysis, these variables can be applied with seasonal forecasts and risk analysis to provide farm recommendations for climate adaptation<span class="citation"><sup>5</sup></span>.</p>
</div>
<div id="source-of-data-and-input" class="section level2">
<h2 class="hasAnchor">
<a href="#source-of-data-and-input" class="anchor"></a>Source of data and input</h2>
<p>Environmental data can be computed using input from time series databases such as the Climate Hazards Group InfraRed Precipitation with Station data (CHIRPS)<span class="citation"><sup>6</sup></span> for rainfall, and MODIS (MYD11A2)<span class="citation"><sup>7</sup></span> for land surface temperature. These databases has the advantage to be free and publicly available sources of global coverage and a high resolution (0.05°), and have been used in previous studies with ClimMob data<span class="citation"><sup>5</sup></span>. However, it requires much computer capacity to extract this information and produce the matrix for the environmental indices. MODIS data also requires some work to reduce noise and fill gaps.</p>
<p>The other alternative relies on using <a href="https://power.larc.nasa.gov/">NASA POWER</a>. By providing the planting dates and the geographic information (lon and lat), <strong>ClimMobTools</strong> makes an internal call to <a href="https://CRAN.R-project.org/package=nasapower">nasapower</a><span class="citation"><sup>8</sup></span> to fetch the required time series data and compute the environmental indices. It do not requires much computer capacity but requires a persistent internet connection. NASAPOWER, however has a low grid resolution (0.5°) compared to MODIS and CHIRPS and could not provide the expected results for GxE interactions in a narrow geographical range.</p>
<div id="breadwheat-data" class="section level3">
<h3 class="hasAnchor">
<a href="#breadwheat-data" class="anchor"></a>Breadwheat data</h3>
<p>In this article we use the <strong>NASA POWER</strong> data via the <code>R</code> package nasapower as external input data for the environmental indices. We use the bread wheat data from Vaishali, India as internal input with planing dates and geographic information. In the <em>Introduction to ClimMobTools</em> <a href="https://agrobioinfoservices.github.io/ClimMobTools/articles/Overview.html">article</a> we show how to fetch the ClimMob data into your <code>R</code> section using an API key.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ClimMobTools"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"nasapower"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"tidyverse"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"magrittr"</span>)

key &lt;-<span class="st"> "d39a3c66-5822-4930-a9d4-50e7da041e77"</span>

data &lt;-<span class="st"> </span>ClimMobTools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ClimMobTools/topics/getDataCM">getDataCM</a></span>(<span class="dt">key =</span> key, 
                                <span class="dt">project =</span> <span class="st">"breadwheat"</span>)


<span class="co"># data into wide format</span>
data <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(<span class="op">!</span><span class="kw">str_detect</span>(variable, <span class="st">"survey"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>(id, variable, value) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(variable, value)

<span class="co"># convert the lon lat into numeric</span>
<span class="co"># and the planting dates into Date</span>
data <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lon =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(lon),
         <span class="dt">lat =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(lat),
         <span class="dt">plantingdate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(plantingdate, 
                                <span class="dt">format =</span> <span class="st">"%Y-%m-%d"</span>))

<span class="co"># use only the first 25 observations</span>
data &lt;-<span class="st"> </span>data[<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>, ]</code></pre></div>
</div>
</div>
<div id="temperature" class="section level2">
<h2 class="hasAnchor">
<a href="#temperature" class="anchor"></a>Temperature</h2>
<p><strong>ClimMobTools</strong> functions to compute environmental indices has the basics input data; a numeric vector of geographic information (lonlat) or an array with day and night temperature (from sources like MODIS) and the a vector of class <code>Date</code> for the first day that will be taken into account for the environmental indices. Generally the <code>Date</code> vector is the planting date from when the experiment were established, but can also refer to other phenological event during the plant development, such as day of 50% flowering.</p>
<p>The duration from where the environmental indices will be computed is defined by the argument <code>span</code> which can be a single integer that takes into account a single time span for all tricot experiments or a vector indicating the time span for each of the observations.</p>
<p>Here we compute the temperature indices for a time span of 120 days after the planting date:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/temperature.html">temperature</a></span>(data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)], 
                    <span class="dt">day.one =</span> data[<span class="st">"plantingdate"</span>], 
                    <span class="dt">span =</span> <span class="dv">120</span>)</code></pre></div>
<div id="timespan-defined-by-growing-degree-days" class="section level3">
<h3 class="hasAnchor">
<a href="#timespan-defined-by-growing-degree-days" class="anchor"></a>Timespan defined by growing degree days</h3>
<p>If the time span is unknown and or there is a interest in capture the variability among different locations. We can apply the function <code>GDD</code> which estimates the number of days needed for the crop to reach the required degree days.</p>
<p>Here we define that the required degree days for wheat is 1800 °C, the growing degree days are computed with a base 5, from planting date and on:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
gdd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/GDD.html">GDD</a></span>(data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)], 
           <span class="dt">day.one =</span> data[<span class="st">"plantingdate"</span>],
           <span class="dt">degree.days =</span> <span class="dv">1800</span>,
           <span class="dt">base =</span> <span class="dv">5</span>)</code></pre></div>
<p>Then, these growing degree days can be applied as time span to compute the temperature:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/temperature.html">temperature</a></span>(data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)], 
                    <span class="dt">day.one =</span> data[<span class="st">"plantingdate"</span>], 
                    <span class="dt">span =</span> gdd)</code></pre></div>
</div>
</div>
<div id="rainfall" class="section level2">
<h2 class="hasAnchor">
<a href="#rainfall" class="anchor"></a>Rainfall</h2>
<p>Precipitation indices can also be computed in the same way as the temperature indices. The external input data can be fetched by NASA POWER or by providing a matrix with CHIRPS data.</p>
<p>Here we use the NASA POWER data with a time span defined by the growing degree days using the function <code>rainfall</code> from <strong>ClimMobTools</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rain &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rainfall.html">rainfall</a></span>(data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)], 
                 <span class="dt">day.one =</span> data[<span class="st">"plantingdate"</span>],
                 <span class="dt">span =</span> gdd)</code></pre></div>
<p>Function <code>rainfall</code> has also a feature that enables the indices to be calculated from some days before the planting date. This is important for case studies where a residual precipitation must be taken into account. To do so, we use the argument <code>days.before</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rain &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rainfall.html">rainfall</a></span>(data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)], 
                 <span class="dt">day.one =</span> data[<span class="st">"plantingdate"</span>], 
                 <span class="dt">span =</span> gdd,
                 <span class="dt">days.before =</span> <span class="dv">15</span>)</code></pre></div>
</div>
<div id="evapotranspiration" class="section level2">
<h2 class="hasAnchor">
<a href="#evapotranspiration" class="anchor"></a>Evapotranspiration</h2>
<p>Evapotranspiration can be defined as the sum of evaporation and plant transpiration from the Earth’s surface to the atmosphere. This is also an important index to include in models for GxE interactions. In <strong>ClimMobTools</strong> the index can be calculate using the function <code>ETo</code> which computes the evapotranspiration based on the Blaney-Criddle method, an ideal equation when only air-temperature data sets are available for a site.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eto &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ETo.html">ETo</a></span>(data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)], 
           <span class="dt">day.one =</span> data[<span class="st">"plantingdate"</span>],
           <span class="dt">span =</span> gdd,
           <span class="dt">lat =</span> data[[<span class="st">"lat"</span>]])</code></pre></div>
<p>Finally, these indices can be combined into a single data set with the <strong>PlackettLuce</strong> rankings to assess if the climate plays a role on the crop performance as shown in this <a href="https://agrobioinfoservices.github.io/ClimMobTools/articles/Overview.html">article</a>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Turner2018">
<p>1. Turner, H., van Etten, J., Firth, D. &amp; Kosmidis, I. Modelling rankings in R: The PlackettLuce package. <em>arXiv:1810.12068</em> (2018).</p>
</div>
<div id="ref-Wickelmaier2018">
<p>2. Wickelmaier, F. &amp; Zeileis, A. Using recursive partitioning to account for parameter heterogeneity in multinomial processing tree models. <em>Behavior Research Methods</em> <strong>50</strong>, 1217–1233 (2018).</p>
</div>
<div id="ref-Kehel2016">
<p>3. Kehel, Z., Crossa, J. &amp; Reynolds, M. Identifying Climate Patterns during the Crop-Growing Cycle from 30 Years of CIMMYT Elite Spring Wheat International Yield Trials. in <em>Applied mathematics and omics to assess crop genetic resources for climate change adaptive traits</em> (eds. Bari, A., Damania, A. B., Mackay, M. &amp; Dayanandan, S.) 151–174 (CRC Press, 2016).</p>
</div>
<div id="ref-Aguilar2005">
<p>4. Aguilar, E., Peterson, T. C., Obando, P. R. &amp; Frutos, R. <em>et al.</em> Changes in precipitation and temperature extremes in Central America and northern South America, 1961–2003. <em>Journal of Geophysical Research</em> <strong>110</strong>, D23107 (2005).</p>
</div>
<div id="ref-VanEtten2019">
<p>5. van Etten, J., de Sousa, K., Aguilar, A. &amp; Barrios, M. <em>et al.</em> Crop variety management for climate adaptation supported by citizen science. <em>Proceedings of the National Academy of Sciences</em> <strong>116</strong>, 4194–4199 (2019).</p>
</div>
<div id="ref-Funk2015">
<p>6. Funk, C., Peterson, P., Landsfeld, M. &amp; Pedreros, D. <em>et al.</em> The climate hazards infrared precipitation with stations—a new environmental record for monitoring extremes. <em>Scientific Data</em> <strong>2</strong>, 150066 (2015).</p>
</div>
<div id="ref-Wan2015">
<p>7. Wan, Z., Hook, S. &amp; Hulley, G. MYD11A1 MODIS/Aqua Land Surface Temperature/Emissivity Daily L3 Global 1km SIN Grid V006 [Data set]. <em>NASA EOSDIS LP DAAC</em> (2015). doi:<a href="https://doi.org/10.5067/MODIS/MYD11A1.006">10.5067/MODIS/MYD11A1.006</a></p>
</div>
<div id="ref-Sparks2018">
<p>8. Sparks, A. H. nasapower: A NASA POWER Global Meteorology, Surface Solar Energy and Climatology Data Client for R. <em>Journal of Open Source Software</em> <strong>3</strong>, 1035 (2018).</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#source-of-data-and-input">Source of data and input</a></li>
      <li><a href="#temperature">Temperature</a></li>
      <li><a href="#rainfall">Rainfall</a></li>
      <li><a href="#evapotranspiration">Evapotranspiration</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kaue de Sousa, Jacob van Etten, Sam Dumble, Brandon Madriz, Carlos Quiros.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
